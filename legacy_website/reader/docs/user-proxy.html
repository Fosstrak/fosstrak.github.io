<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>Fosstrak Reader - User Guide Proxy</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
          <meta name="author" content="Jonas Haller" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
      </head>
  <body class="composite">
    <div id="banner">
                  <a href="../" id="bannerLeft">
    
                                            <img src="../images/banner_left.gif" alt="" />
    
            </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
  

  
    
  
  
            <div class="xleft">
        Last Published: Oct 20, 2008 05:34:29 CEST
                          |   
          <a href="../../index.html">Fosstrak</a>
              &gt;
      
          <a href="../">Reader</a>
                        </div>
            <div class="xright">      <a href="../../index.html">Fosstrak</a>
          |
          <a href="../index.html">Reader</a>
          |
          <a href="../../fc/index.html">Filtering and Collection</a>
          |
          <a href="../../epcis/index.html">EPCIS</a>
          |
          <a href="../../tdt/index.html">Tag Data Translation</a>
          |
          <a href="../../hal/index.html">HAL</a>
          
  

  
    
  
  
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
  

  
    
  
  
                   <h5>Fosstrak</h5>
        <ul>
              
    <li class="none">
              <a href="../../index.html">Home</a>
        </li>
          </ul>
          <h5>Reader Project</h5>
        <ul>
              
    <li class="none">
              <a href="../index.html">Overview</a>
        </li>
              
    <li class="none">
              <a href="../features.html">Features</a>
        </li>
              
    <li class="none">
              <a href="../demo.html">Demo</a>
        </li>
              
    <li class="none">
              <a href="../download.html">Download</a>
        </li>
              
    <li class="none">
              <a href="../license.html">License</a>
        </li>
              
    <li class="none">
              <a href="../faq.html">FAQ</a>
        </li>
              
    <li class="none">
              <a href="../howtohelp.html">How to help</a>
        </li>
              
    <li class="none">
              <a href="../team-list.html">Project Team</a>
        </li>
              
    <li class="none">
              <a href="../mail-lists.html">Mailing Lists</a>
        </li>
              
    <li class="none">
              <a href="../issue-tracking.html">Issue Tracking</a>
        </li>
              
    <li class="none">
              <a href="../source-repository.html">Source Repository</a>
        </li>
          </ul>
          <h5>Guides &amp; Documentation</h5>
        <ul>
              
          
              
      
            
            
            
      
            
      
              
            <li class="expanded">
              <a href="../docs/user-index.html">User</a>
                <ul>
                  
    <li class="none">
              <a href="../docs/user-core.html">Core</a>
        </li>
                  
    <li class="none">
              <strong>Proxy</strong>
        </li>
                  
    <li class="none">
              <a href="../docs/user-client.html">Client</a>
        </li>
                  
    <li class="none">
              <a href="../docs/user-changelog.html">User Changlog</a>
        </li>
              </ul>
        </li>
              
          
              
      
            
      
              
        <li class="expanded">
              <a href="../docs/developer-index.html">Developer</a>
                <ul>
                  
    <li class="none">
              <a href="../docs/developer-guide.html">Developer Guide</a>
        </li>
                  
    <li class="none">
              <a href="../docs/developer-changelog.html">Developer Changelog</a>
        </li>
              </ul>
        </li>
              
    <li class="none">
              <a href="../apidocs/index.html">JavaDoc</a>
        </li>
          </ul>
          <h5>Reader Project Modules</h5>
        <ul>
              
                
              
      
              
        <li class="collapsed">
              <a href="../reader-rprm-core/project-reports.html">RP/RM Core</a>
              </li>
              
                
              
      
              
        <li class="collapsed">
              <a href="../reader-rp-proxy/project-reports.html">RP Proxy</a>
              </li>
              
                
              
      
              
        <li class="collapsed">
              <a href="../reader-rp-client/project-reports.html">RP Client</a>
              </li>
          </ul>
                                             
                        
                        
            <a href="http://www.autoidlabs.org/" title="Auto-ID" id="poweredBy">
                            <img alt="Auto-ID" src="../images/logos/supportedByAutoid4.png" />
            </a>
                               
  

  
    
  
  
        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>User Guide Reader RP Proxy</h2><div class="section"><h3>Contents</h3><ol type="1"><li><a href="#Features">Features</a></li><li><a href="#Application">Field of Application</a></li><li><a href="#Installing">Installing the Fosstrak Reader RP Proxy</a></li><li><a href="#First">First Steps</a><ul><li><a href="#method">Use proxy with method calls</a></li><li><a href="#configuration">Use proxy with configuration engine</a></li></ul></li></ol></div><div class="section"><h3><a name="Features">Features</a></h3><p>The Fosstrak Reader RP Proxy is a Java class library that supports the communication with a reader that implements the EPCglobal Reader Protocol Version 1.1.</p><p>Implemented elements of the protocol include:</p><ul><li>Transport Binding: TCP and HTTP</li><li>Message Binding: XML and Text</li><li>Synchronous and Asynchronous Messaging (Notification Channels)</li><li>Triggers</li><li>Data Selectors</li></ul><p>The reader can be configured through a method call for each command or all the settings can be written into a configuration file which is processed by an automated configurator.</p></div><div class="section"><h3>Field of <a name="Application">Application</a></h3><ul><li>Communicate with a reader via the EPCglobal Reader Protocol Version 1.1 from within your Java application.</li><li>Implement the <tt>NotificationChannelListener</tt> interface to receive notifications from the reader in your Java application.</li></ul><img src="../images/ReaderProxy_architecture.png" /></div><div class="section"><h3><a name="Installing">Installing</a> the Fosstrak Reader RP Proxy</h3><p>The following instructions show how to install the Fosstrak Reader RP Proxy:</p><ul><li>Download the Reader RP Proxy binaries with the dependencies included from the <a href="../download.html">download</a> section of the website.</li><li>Unzip the downloaded file.</li><li>Add the jar to your classpath.</li><li>All the <a href="dependencies.html"> dependencies</a> should be accessible through your classpath as well. This should be the case if you use the zip with all the dependencies included.</li><li>Make sure you are using a Java Runtime Environment 1.5 or higher.</li><li>Use the proxy as outlined in the two examples below.</li></ul></div><div class="section"><h3><a name="First">First</a> Steps</h3><div class="section"><h4>Configure the reader with a series of Java <a name="method">method</a> calls</h4><p>This example requires that there is a reader running that supports the HTTP/XML transport message binding of the Reader Protocol available at localhost:8000. If these settings are incorrect for your setup, you will need to adjust the following variables:</p><ul><li>MESSAGE_FORMAT</li><li>TRANSPORT_PROTOCOL</li><li>COMMAND_CHANNEL_HOST</li><li>COMMAND_CHANNEL_PORT</li></ul><p>You might also want to consider using our existing Java implementation of a <a href="../index.html">reader</a> which includes a simulation engine.</p><div class="source"><pre>import org.fosstrak.reader.rprm.core.EventType;
import org.fosstrak.reader.rprm.core.FieldName;
import org.fosstrak.reader.rp.proxy.DataSelector;
import org.fosstrak.reader.rp.proxy.NotificationChannel;
import org.fosstrak.reader.rp.proxy.ReaderDevice;
import org.fosstrak.reader.rp.proxy.Source;
import org.fosstrak.reader.rp.proxy.Trigger;
import org.fosstrak.reader.rp.proxy.factories.DataSelectorFactory;
import org.fosstrak.reader.rp.proxy.factories.NotificationChannelFactory;
import org.fosstrak.reader.rp.proxy.factories.ReaderDeviceFactory;
import org.fosstrak.reader.rp.proxy.factories.TriggerFactory;
import org.fosstrak.reader.rp.proxy.msg.Handshake;

public class ReaderProxyExample {

   private static int MESSAGE_FORMAT = Handshake.FORMAT_XML;
   private static int TRANSPORT_PROTOCOL = Handshake.HTTP;

   private static final String COMMAND_CHANNEL_HOST = &quot;localhost&quot;;
   private static final int COMMAND_CHANNEL_PORT = 8000;

   private static final String READ_TRIGGER_NAME = &quot;ReadTrigger&quot;;
   private static final String READ_TRIGGER_TYPE = Trigger.TIMER;
   private static final String READ_TRIGGER_VALUE = &quot;ms=2000&quot;;

   private static final String NOTIFICATION_TRIGGER_NAME = &quot;NotificationTrigger&quot;;
   private static final String NOTIFICATION_TRIGGER_TYPE = Trigger.CONTINUOUS;
   private static final String NOTIFICATION_TRIGGER_VALUE = &quot;&quot;;

   private static final String DATA_SELECTOR_NAME = &quot;DataSelector&quot;;
   private static final String[] EVENT_FILTERS = new String[] {
         EventType.EV_OBSERVED, EventType.EV_LOST};
   private static final String[] FIELD_NAMES = new String[] {
         FieldName.EVENT_TYPE, FieldName.READER_NAME, FieldName.TAG_ID,
         FieldName.TAG_ID_AS_PURE_URI, FieldName.TAG_ID_AS_TAG_URI,
         FieldName.SOURCE_NAME};

   private static final String NOTIFICATION_CHANNEL_NAME = &quot;NotificationChannel&quot;;
   private static final String NOTIFICATION_CHANNEL_HOST = &quot;localhost&quot;;
   private static final int NOTIFICATION_CHANNEL_PORT = 9000;
   private static final String NOTIFICATION_CHANNEL_MODE = &quot;connect&quot;;
   private static final String NOTIFICATION_CHANNEL_ADDRESS = &quot;tcp://&quot;
         + NOTIFICATION_CHANNEL_HOST + &quot;:&quot; + NOTIFICATION_CHANNEL_PORT
         + &quot;?mode=&quot; + NOTIFICATION_CHANNEL_MODE;

   public static void main(String[] args) throws Exception {
      // create handshake
      Handshake handshake = new Handshake();
      handshake.setMessageFormat(MESSAGE_FORMAT);
      handshake.setTransportProtocol(TRANSPORT_PROTOCOL);

      // get reader device proxy
      System.out.println(&quot;Get reader device proxy.&quot;);
      ReaderDevice readerDevice = ReaderDeviceFactory.getReaderDevice(
            COMMAND_CHANNEL_HOST, COMMAND_CHANNEL_PORT, handshake);

      // get current source proxy
      System.out.println(&quot;Get current source.&quot;);
      Source source = readerDevice.getCurrentSource();
      System.out.println(&quot;Name of current source is: &quot; + source.getName());

      // create read trigger
      System.out.println(&quot;Create read trigger.&quot;);
      Trigger readTrigger = TriggerFactory.createTrigger(READ_TRIGGER_NAME,
            READ_TRIGGER_TYPE, READ_TRIGGER_VALUE, readerDevice);

      // create notification trigger
      System.out.println(&quot;Create notification trigger.&quot;);
      Trigger notificationTrigger = TriggerFactory.createTrigger(
            NOTIFICATION_TRIGGER_NAME, NOTIFICATION_TRIGGER_TYPE,
            NOTIFICATION_TRIGGER_VALUE, readerDevice);

      // data selector
      System.out.println(&quot;Create data selector.&quot;);
      DataSelector dataSelector = DataSelectorFactory.createDataSelector(
            DATA_SELECTOR_NAME, readerDevice);
      System.out.println(&quot;Add event filters to data selector.&quot;);
      dataSelector.addEventFilters(EVENT_FILTERS);
      System.out.println(&quot;Add field names to data selector.&quot;);
      dataSelector.addFieldNames(FIELD_NAMES);
      //System.out.println(&quot;Add tag fields to data selector.&quot;);
      //dataSelector.addTagFieldNames(TAG_FIELDS);

      // create notification channel
      System.out.println(&quot;Create notification channel.&quot;);
      NotificationChannel notificationChannel = NotificationChannelFactory
            .createNotificationChannel(NOTIFICATION_CHANNEL_NAME,
            NOTIFICATION_CHANNEL_ADDRESS, readerDevice);
      System.out.println(&quot;Set data selector of notification channel.&quot;);
      notificationChannel.setDataSelector(dataSelector);
      System.out.println(&quot;Add notification trigger to notification channel.&quot;);
      notificationChannel.addNotificationTriggers(
            new Trigger[] {notificationTrigger});

      // add current source to notification channel
      System.out.println(&quot;Add source to notification channel.&quot;);
      notificationChannel.addSources(new Source[] {source});

      // add read trigger to source
      System.out.println(&quot;Add read trigger to source.&quot;);
      source.addReadTriggers(new Trigger[] {readTrigger});
   }
}</pre></div><p>In order to process the notification messages from the reader, the proxy provides the class org.fosstrak.reader.rp.proxy.NotificationChannelEndPoint. The class that is interested in receiving the notification messages has to implement the interface org.fosstrak.reader.rp.proxy.NotificationChannelListener and has to be registered with the NotificationChannelEndPoint as shown below.</p><div class="source"><pre>import org.fosstrak.reader.rp.proxy.NotificationChannelListener;
import org.fosstrak.reader.rprm.core.msg.notification.Notification;

public class ReaderNotificationChannelListener implements NotificationChannelListener {

   public void dataReceived(Notification notification) {
      System.out.println(&quot;Notification received: &quot; + notification);

      // add your code to process notification message here
   }
}</pre></div><p>Code to create a NotificationChannelListener and to add a listener to it:</p><div class="source"><pre>   NotificationChannelListener notificationChannelListener =
         new ReaderNotificationChannelListener();

   // create notification channel endpoint to receive messages
   System.out.println(&quot;Create NotificationChannelEndpoint at port '&quot;
         + NOTIFICATION_CHANNEL_PORT + &quot;'.&quot;);
   NotificationChannelEndPoint notificationChannelEndPoint =
         new NotificationChannelEndPoint(NOTIFICATION_CHANNEL_PORT);

   // add listerner to notification channel endpoint
   notificationChannelEndPoint.addListener(notificationChannelListener);</pre></div></div><div class="section"><h4>Configure the reader with the <a name="configuration">configuration</a> engine and a corresponding configuration file</h4><p>An other way to configure the reader is to use the <tt>ReaderConfigurator</tt> that is part of the Fosstrak Reader RP Proxy module. It is less flexible than using method calls for each configuration item but needs less code too.</p><div class="source"><pre>import org.apache.log4j.Logger;
import org.apache.log4j.BasicConfigurator;
import org.fosstrak.reader.proxy.configurator.ReaderConfigurator;

public class ReaderConfiguratorExample {

   private static final String CONFIG_FILE_PATH =
         &quot;./props/ReaderDeviceConfiguration.xml&quot;;

   private static final Logger LOG = Logger.getLogger(
         ReaderConfiguratorExample.class);

   public static void main(String[] args) throws Exception {

      // initialize the logger
      BasicConfigurator.configure();

      // configure the reader
      LOG.info(&quot;Configurate reader device.&quot;);
      ReaderConfigurator.initReaderDeviceConfiguration(CONFIG_FILE_PATH);
   }
}</pre></div><p>The corresponding ReaderDeviceConfiguration.xml configuration file looks like this:</p><div class="source"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configurationDocument xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;ReaderDeviceConfiguration.xsd&quot;&gt;
   &lt;readerDeviceConfiguration&gt;

      &lt;!-- reader configuration --&gt;
      &lt;readerConfig&gt;
         &lt;commandChannelHost&gt;localhost&lt;/commandChannelHost&gt;
         &lt;commandChannelPort&gt;8000&lt;/commandChannelPort&gt;
         &lt;transportProtocol&gt;HTTP&lt;/transportProtocol&gt;
         &lt;transportFormat&gt;XML&lt;/transportFormat&gt;
      &lt;/readerConfig&gt;

      &lt;!-- read triggers --&gt;
      &lt;triggers&gt;
         &lt;timerTrigger name=&quot;ReadTrigger&quot;&gt;
            &lt;value&gt;2000&lt;/value&gt;
         &lt;/timerTrigger&gt;
      &lt;/triggers&gt;

      &lt;!-- notification triggers --&gt;
      &lt;triggers&gt;
         &lt;continuousTrigger name=&quot;NotificationTrigger&quot;/&gt;
      &lt;/triggers&gt;

      &lt;!-- data selectors --&gt;
      &lt;dataSelectors&gt;
         &lt;dataSelector name=&quot;DataSelector&quot;&gt;
            &lt;fieldNames&gt;
               &lt;fieldName&gt;eventType&lt;/fieldName&gt;
               &lt;fieldName&gt;readerName&lt;/fieldName&gt;
               &lt;fieldName&gt;tagID&lt;/fieldName&gt;
               &lt;fieldName&gt;tagIDasPureURI&lt;/fieldName&gt;
               &lt;fieldName&gt;tagIDasTagURI&lt;/fieldName&gt;
               &lt;fieldName&gt;sourceName&lt;/fieldName&gt;
            &lt;/fieldNames&gt;
            &lt;eventFilters&gt;
               &lt;eventFilter&gt;evObserved&lt;/eventFilter&gt;
               &lt;eventFilter&gt;evLost&lt;/eventFilter&gt;
            &lt;/eventFilters&gt;
         &lt;/dataSelector&gt;
      &lt;/dataSelectors&gt;

      &lt;!-- notification channels --&gt;
      &lt;notificationChannels&gt;
         &lt;notificationChannel name=&quot;NotificationChannel&quot;&gt;
            &lt;notificationChannelHost&gt;localhost&lt;/notificationChannelHost&gt;
            &lt;notificationChannelPort&gt;9000&lt;/notificationChannelPort&gt;
            &lt;transportProtocol&gt;TCP&lt;/transportProtocol&gt;
            &lt;notificationChannelMode&gt;connect&lt;/notificationChannelMode&gt;
            &lt;sources&gt;
               &lt;source&gt;Shelf1&lt;/source&gt;
            &lt;/sources&gt;
            &lt;notificationTriggers&gt;
               &lt;triggerName&gt;NotificationTrigger&lt;/triggerName&gt;
            &lt;/notificationTriggers&gt;
            &lt;dataSelector&gt;DataSelector&lt;/dataSelector&gt;
         &lt;/notificationChannel&gt;
      &lt;/notificationChannels&gt;

      &lt;!-- sources --&gt;
      &lt;sources&gt;
         &lt;source name=&quot;Shelf1&quot;&gt;
            &lt;triggerName&gt;ReadTrigger&lt;/triggerName&gt;
         &lt;/source&gt;
      &lt;/sources&gt;

   &lt;/readerDeviceConfiguration&gt;
&lt;/configurationDocument&gt;</pre></div></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2008
    
          
  

  
    
  
  
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
