<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">











<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Fosstrak LLRP Commander - Developers guide - Repository</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
      </head>
  <body class="composite">
    <div id="banner">
                  <a href="../" id="bannerLeft"  >
    
                                            <img src="../images/banner_left.gif" alt="Fosstrak" />
    
            </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
  

  
    
    
  
    
            <div class="xleft">
      <!--
        Version: 1.1.1-SNAPSHOT
	-->
                     
                <a href="../../index.html">Fosstrak</a>
                &gt;
      
                <a href="../">LLRP Commander</a>
                          </div>
            <div class="xright">            <a href="../../epcis/index.html">EPCIS Repository</a>
            |
                <a href="../../tdt/index.html">TDT Engine</a>
            |
                <a href="../../fc/index.html">ALE Middleware</a>
            |
                <a href="../index.html">LLRP Commander</a>
            
  

  
    
    
  
    
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
  

  
    
    
  
    
                   <h5>LLRP Commander</h5>
            <ul>
              
    <li class="none">
                    <a href="../index.html">Overview</a>
          </li>
              
    <li class="none">
                    <a href="../features.html">Features</a>
          </li>
              
    <li class="none">
                    <a href="../download.html">Install</a>
          </li>
              
    <li class="none">
                    <a href="../background.html">Background</a>
          </li>
              
    <li class="none">
                    <a href="../license.html">License</a>
          </li>
              
    <li class="none">
                    <a href="../mail-lists.html">Mailing Lists</a>
          </li>
              
    <li class="none">
                    <a href="../issue-tracking.html">Issue Tracking</a>
          </li>
          </ul>
              <h5>Guides and Documentation</h5>
            <ul>
              
    <li class="none">
                    <a href="../docs/user-index.html">User Guide</a>
          </li>
              
          
                    
                  
                  
                  
                  
                  
                  
                        
                  
                  
                  
                              
                  
              
        <li class="expanded">
                    <a href="../docs/developer-index.html">Developer Guide</a>
                  <ul>
                  
    <li class="none">
                    <a href="../docs/developer-installation.html">Installation</a>
          </li>
                  
          
                    
                  
                  
                  
                  
              
        <li class="expanded">
                    <a href="../docs/developer-gui.html">GUI</a>
                  <ul>
                  
    <li class="none">
                    <a href="../docs/developer-graphical.html">Graphical Editor</a>
          </li>
                  
    <li class="none">
                    <a href="../docs/developer-xml.html">XML / Binary Editor</a>
          </li>
                  
    <li class="none">
                    <a href="../docs/developer-navigator.html">Navigator</a>
          </li>
                  
    <li class="none">
                    <a href="../docs/developer-explorer.html">Reader Explorer</a>
          </li>
                  
    <li class="none">
                    <a href="../docs/developer-wizard.html">Wizard</a>
          </li>
              </ul>
        </li>
                  
          
                    
                  
                  
              
        <li class="expanded">
                    <a href="../docs/developer-mgmt.html">Management</a>
                  <ul>
                  
    <li class="none">
                    <a href="../docs/developer-adaptormanagement.html">Adaptor Management</a>
          </li>
                  
    <li class="none">
                    <a href="../docs/developer-adaptors.html">Adaptors</a>
          </li>
                  
    <li class="none">
                    <a href="../docs/developer-readers.html">Readers</a>
          </li>
              </ul>
        </li>
                  
    <li class="none">
              <strong>Repository</strong>
        </li>
                  
    <li class="none">
                    <a href="../apidocs/index.html">JavaDoc</a>
          </li>
              </ul>
        </li>
          </ul>
              <h5>LLRP Commander Modules</h5>
            <ul>
              
                
                    
              
        <li class="collapsed">
                    <a href="../llrp-adaptor/project-reports.html">LLRP Adaptor</a>
                </li>
              
                
                    
              
        <li class="collapsed">
                    <a href="../llrp_commander/project-reports.html">LLRP Commander</a>
                </li>
          </ul>
                                                 
                        
                        
            <a href="http://www.autoidlabs.org/" title="Auto-ID" class="poweredBy">
                            <img  class="poweredBy"  
                    alt="Auto-ID" 
                    src="../images/logos/supportedByAutoid4.png" 
                    width="90"
                    height="30"
              />
            </a>
                               
  

  
    
    
  
    
        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Developers guide - Repository</h2><div class="section"><h3>Content</h3><ol type="1"><li><a href="#Overview">Overview</a></li><li><a href="#Design">Design and Implementation</a></li><li><a href="#Derby">Derby as backend</a></li><li><a href="#MySQL">MySQL as backend</a></li><li><a href="#PostgreSQL">PostgreSQL as backend</a></li><li><a href="#Connect">Connect to the Database with Matlab</a></li><li><a href="#Appendix">Appendix</a></li></ol></div><div class="section"><h3><a name="Overview">Overview</a></h3><p>This guide will give a short overview to design and implementation of the LLRP message repository. The message repository provides two different datastructures:</p><ul><li><b>Repository</b> storing and exporting all incomming and sent LLRP messages in full together with control structure (when the message was received, from which reader and adapter, etc.). Stored LLRP messages can be reconstructed completely from this datastructure.</li><li><b>ROAccessReportsRepository</b> saving RO_ACCESS_REPORT LLRP messages in a serialized form. This repository gives a more convenient way, how to access the message content of LLRP messages with tag reports. <p><b>NOTICE</b>: The <i>ROAccessReportsRepository</i> is optional!</p></li></ul></div><div class="section"><h3><a name="Design">Design</a> and Implementation</h3><p>The <i>Repository</i> and <i>ROAccessReportsRepository</i> both implement a <a href="http://en.wikipedia.org/wiki/Strategy_pattern">Strategy Pattern</a> allowing to exchange the underlying repository implementation transparently. At runtime, the LLRP Commander automatically invokes the &quot;Concrete Strategy&quot; depending on the configuration specified by the user.</p><img src="../images/developer/repositoryDesign.png" /><div class="section"><h4>Strategy pattern for <i>Repository</i></h4><p><i>ResourceCenter</i> represents the &quot;Context&quot; and <i>Repository</i> models the &quot;Strategy&quot;. </p><p>Currently the LLRP Commander provides three different &quot;Concrete Strategies&quot;, namely the default repository implemented by a file-based Java Derby Repository (<i>org.fosstrak.llrp.client.repository.sql.DerbyRepository</i>), the external PostgreSQL Repository (<i>org.fosstrak.llrp.client.repository.sql.PostgreSQLRepository</i>) and the external MySQL database (<i>org.fosstrak.llrp.client.repository.sql.MySQLRepository</i>). </p></div><div class="section"><h4>Strategy pattern for <i>ROAccessReportsRepository</i></h4><p><i>Repository</i> represents the &quot;Context&quot; and <i>ROAccessReportsRepository</i> models the &quot;Strategy&quot;. </p><p>Currently the LLRP Commander uses only one &quot;Concrete Strategy&quot; for the two &quot;Contexts&quot; Derby/MySQL implemented by <i>org.fosstrak.llrp.client.repository.sql.DerbyROAccessReportsRepository</i>. </p><p><b>NOTICE:</b> <i>ROAccessReportsRepository</i> is not accessible without <i>Repository</i>!</p></div><div class="section"><h4>Access with Java</h4><p>Users, that like to access the <i>Repository</i> from within the LLRP Commander, can use the <i>ResourceCenter</i> for that purpose:</p><div class="source"><pre>// how to get a handle to the Repository
Repository repository = ResourceCenter.getInstance().getRepository();</pre></div><p>Access to the <i>ROAccessReportsRepository</i> can then be gained via the <i>Repository</i>:</p><div class="source"><pre>// how to get a handle on the ROAccessReportsRepository:

// first get a handle of the repository:
Repository repository = ResourceCenter.getInstance().getRepository();

// now obtain a handle of the ROAccessReportsRepository
ROAccessReportsRepository roAccessReportsRepo = repository.getROAccessRepository();</pre></div></div></div><div class="section"><h3><a name="Derby">Derby</a> as backend </h3><p>By default, the LLRP Commander uses the derby interface as its primary logging backend (zero configuration). In the eclipse preferences page select the option &quot;Use internal standalone Derby Database&quot; (should be checked by default).</p></div><div class="section"><h3><a name="MySQL">MySQL</a> as backend</h3><p>In order to log the LLRP messages to an external MySQL database, the LLRP Commander needs access to a database of the MySQL server. Please be aware that MySQL currently is not able to log fractional time-parts (milliseconds and smaller). So, if you plan to inspect the timestamp on such a fine grain level, you should probably consider using the <a href="#PostgreSQL">PostgreSQL</a> database.</p><p>We assume, that you have MySQL installed and running on your system.</p><p>Log into the MySQL Command Line Client as root and perform the following steps:</p><ol type="1"><li>Create the database (preferably use <b>llrpMsgDB</b> as the name).<div class="source"><pre>mysql&gt; CREATE DATABASE llrpMsgDB;</pre></div></li><li>Create a user that is allowed to access the database. We use username <b>llrp</b> and password <b>llrp</b>.<div class="source"><pre>mysql&gt; GRANT CREATE,SELECT,INSERT,UPDATE,DELETE,DROP ON llrpMsgDB.* TO llrp IDENTIFIED BY 'llrp';</pre></div></li><li>Update the settings in the eclipse preferences page:<ol type="i"><li>Ensure to uncheck &quot;Use internal standalone Derby Database&quot;.</li><li>Specify the DB implementor<div class="source"><pre>For the Fosstrak MySQL-connector this equals to:
org.fosstrak.llrp.client.repository.sql.MySQLRepository</pre></div></li><li>Set the JDBC Connect URL.<div class="source"><pre>Syntax: jdbc:mysql://&lt;HOSTNAME_OR_IP&gt;:&lt;PORT&gt;/&lt;DATABASE&gt;

If you set the database to llrpMsgDB and the MySQL server runs on the localhost, put:
jdbc:mysql://localhost:3306/llrpMsgDB</pre></div></li><li>Set the username to <b>llrp</b> and the password to <b>llrp</b>.</li><li>Click on the button &quot;Test&quot;. If no error occurs, the &quot;Switch&quot; button is enabled and you can switch your backend at runtime. </li><li>Although the LLRP Commander supports &quot;on-the-fly&quot; exchange of the repository, we recommend you to restart eclipse in order to load the new configuration from scratch.</li></ol></li></ol></div><div class="section"><h3><a name="PostgreSQL">PostgreSQL</a> as backend</h3><p>In order to log the LLRP messages to an external PostgreSQL database, the LLRP Commander needs access to a database of the PostgreSQL server.</p><ol type="1"><li>Open the PostgreSQL admin tool (pgAdmin) and connect to your server. On *nix you can alternatively use the command-line to create the database and the roles.<ol type="i"><li>Create a new <i>Login Role</i> with Role-name <b>llrp</b> and password <b>llrp</b>. In <i>Role Privileges</i> check <i>Can create database objects</i> (see <a href="#Appendix">Appendix</a>).<div class="source"><pre>Command-line command to create the role in *nix
&gt; sudo -u postgres createuser -D -A -P llrp</pre></div></li><li>Create the database (preferably use <b>llrpmsgdb</b> as the name) and set the owner to <b>llrp</b>.<div class="source"><pre>Command-line command to create the database in *nix
&gt; sudo -u postgres createdb -O llrp llrpmsgdb</pre></div></li></ol></li><li>Update the settings in the eclipse preferences page:<ol type="i"><li>Ensure to uncheck &quot;Use internal standalone Derby Database&quot;.</li><li>Specify the DB implementor<div class="source"><pre>For the Fosstrak PostgreSQL-connector this equals to:
org.fosstrak.llrp.client.repository.sql.PostgreSQLRepository</pre></div></li><li>Set the JDBC Connect URL.<div class="source"><pre>Syntax: jdbc:postgresql://&lt;HOSTNAME_OR_IP&gt;:&lt;PORT&gt;/&lt;DATABASE&gt;

If you set the database to llrpmsgdb and the PostgreSQL server runs on the localhost, put:
jdbc:postgresql://localhost:5432/llrpmsgdb</pre></div></li><li>Set the username to <b>llrp</b> and the password to <b>llrp</b>.</li><li>Click on the button &quot;Test&quot;. If no error occurs, the &quot;Switch&quot; button is enabled and you can switch your backend at runtime. </li><li>Although the LLRP Commander supports &quot;on-the-fly&quot; exchange of the repository, we recommend you to restart eclipse in order to load the new configuration from scratch.</li></ol></li></ol></div><div class="section"><h3><a name="Connect">Connect</a> to the Database with Matlab</h3><p>Make sure to configure the LLRP Commander to use either the MySQL or the PostgreSQL database as backend!</p><p>Connect from Matlab:</p><ol type="1"><li>You need to add the MySQL or PostgreSQL JDBC-Connector to the Java classpath of Matlab before you can establish a connection to the SQL server. <ol type="i"><li>Either obtain a copy of the MySQL JDBC-Connector (<a href="http://dev.mysql.com/downloads/connector/j/5.1.html">download</a>) or PostgreSQL (<a href="http://jdbc.postgresql.org/download.html">download</a> - please select JDBC-4 8.3.*). <p>Store the file to a location of your choice.</p></li><li>Add a reference in the Matlab java classpath.txt. You can find the file in the folder <i>matlabroot\toolbox\local\classpath.txt</i>.<div class="source"><pre>file: matlabroot\toolbox\local\classpath.txt
Example: add reference to the JDBC Connector
...
c:/sqlDrivers/mysql-connector-java-5.1.6.jar
c:/sqlDrivers/postgresql-8.3-603.jdbc4.jar</pre></div></li><li>Restart Matlab!</li></ol></li><li>Establish a connection to the database:<div class="source"><pre>Example MySQL:
&gt;&gt; conn = database('llrpMsgDB', 'llrp', 'llrp', 'com.mysql.jdbc.Driver', 'jdbc:mysql://localhost:3306/llrpMsgDB');

Example PostgreSQL:
&gt;&gt; conn = database('llrpmsgdb', 'llrp', 'llrp', 'org.postgresql.Driver', 'jdbc:postgresql://localhost:3306/llrpmsgdb');</pre></div><ol type="i"><li>Example how to fetch all the entries already logged into the database:<div class="source"><pre>&gt;&gt; result = get(fetch(exec(conn, 'SELECT * FROM table_ro_access_reports')), 'Data');</pre></div></li><li>Example how to fetch all the EPCs:<div class="source"><pre>&gt;&gt; result = get(fetch(exec(conn, 'SELECT count(EPC) FROM table_ro_access_reports')), 'Data');</pre></div></li><li>Example how to display the results:<div class="source"><pre>&gt;&gt; disp(result)</pre></div></li></ol></li></ol></div><div class="section"><h3><a name="Appendix">Appendix</a></h3><p>User-settings for the PostgreSQL:</p><img src="../images/developer/developerPostgreUser.png" /></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2009
    
          
  

  
    
    
  
    
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      </script>
      <script type="text/javascript">
      try {
      var pageTracker = _gat._getTracker("UA-9846531-1");
      pageTracker._trackPageview();
      } catch(err) {}
      </script> 
  </body>
</html>
